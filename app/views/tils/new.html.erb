<%= turbo_frame_tag "til" do %>
  <div class="flex flex-col gap-6">
    <div class="flex items-center justify-between">
      <p class="text-xl font-bold text-neutral">新しいmdファイルにTILを記録</p>
      <%= link_to task_path(@task), data: { turbo_frame: "til" }, class: "btn btn-ghost" do %>
        戻る
      <% end %>
    </div>

    <!-- リポジトリ選択フォーム（GET） -->
    <%= form_with url: new_task_til_path(@task), method: :get, data: { turbo_frame: "til" }, class: "flex flex-col gap-1" do |f| %>
      <%= f.label :repo, "リポジトリを選択", class: "label text-sm text-neutral font-semibold" %>
      <%= f.select :repo,
                    @repositories.map { |r| ["#{r.owner.login}/#{r.name}", r.full_name] },
                    { include_blank: "選択してください", selected: @selected_repo },
                    { class: "select select-bordered w-full",
                      onchange: "this.form.requestSubmit()" } %>
    <% end %>

    <!-- 新規mdファイル作成フォーム（POST） -->
    <% if @selected_repo %>
      <div class="flex flex-col gap-2">
        <%= form_with url: task_til_path(@task), method: :post, data: { turbo_frame: "til" }, class: "flex flex-col gap-2" do |f| %>
          <%= f.hidden_field :repo, value: @selected_repo %>
          <%= f.label :path, "新しいmdファイルのパス名", class: "label text-sm text-neutral font-semibold" %>
          <%= f.text_field :path, 
                          placeholder: "category/today_i_learned.md", 
                          class: "input input-bordered input-neutral w-full" %>
          <%= f.label :message, "コミットメッセージ", class: "label text-sm text-neutral font-semibold" %>
          <%= f.text_field :message, 
                          value: "Add TIL: #{(@task.title || 'task')}", 
                          class: "input input-bordered input-neutral w-full" %>
          <%= f.label :body, "mdファイルの内容", class: "label text-sm text-neutral font-semibold" %>
          <%= f.text_area :body, 
                         rows: 16, 
                         placeholder: "今日学んだことを記録しましょう",
                         class: "textarea textarea-bordered text-area-neutral w-full" %>
          <div class="flex justify-end">
            <%= f.submit "GitHubリポジトリに保存", class: "btn btn-primary rounded-full shadow-none w-full" %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>
